(function(){var h="ckCsrfToken";function c(l,n){var o=[];if(!n){return l}else{for(var m in n){o.push(m+"="+encodeURIComponent(n[m]))}}return l+((l.indexOf("?")!=-1)?"&":"?")+o.join("&")}function b(m){m+="";var l=m.charAt(0).toUpperCase();return l+m.substr(1)}function g(){var n=this.getDialog();var p=n.getParentEditor();p._.filebrowserSe=this;var o=p.config["filebrowser"+b(n.getName())+"WindowWidth"]||p.config.filebrowserWindowWidth||"80%";var l=p.config["filebrowser"+b(n.getName())+"WindowHeight"]||p.config.filebrowserWindowHeight||"70%";var q=this.filebrowser.params||{};q.CKEditor=p.name;q.CKEditorFuncNum=p._.filebrowserFn;if(!q.langCode){q.langCode=p.langCode}var m=c(this.filebrowser.url,q);p.popup(m,o,l,p.config.filebrowserWindowFeatures||p.config.fileBrowserWindowFeatures)}function f(n){var l;var m=new CKEDITOR.dom.element(n.$.form);if(m){l=m.$.elements[h];if(!l){l=new CKEDITOR.dom.element("input");l.setAttributes({name:h,type:"hidden"});m.append(l)}else{l=new CKEDITOR.dom.element(l)}l.setAttribute("value",CKEDITOR.tools.getCsrfToken())}}function k(){var l=this.getDialog();var m=l.getParentEditor();m._.filebrowserSe=this;if(!l.getContentElement(this["for"][0],this["for"][1]).getInputElement().$.value){return false}if(!l.getContentElement(this["for"][0],this["for"][1]).getAction()){return false}return true}function i(l,m,n){var o=n.params||{};o.CKEditor=l.name;o.CKEditorFuncNum=l._.filebrowserFn;if(!o.langCode){o.langCode=l.langCode}m.action=c(n.url,o);m.filebrowser=n}function d(s,o,n,l){if(!l||!l.length){return}var q;for(var r=l.length;r--;){q=l[r];if(q.type=="hbox"||q.type=="vbox"||q.type=="fieldset"){d(s,o,n,q.children)}if(!q.filebrowser){continue}if(typeof q.filebrowser=="string"){var p={action:(q.type=="fileButton")?"QuickUpload":"Browse",target:q.filebrowser};q.filebrowser=p}if(q.filebrowser.action=="Browse"){var m=q.filebrowser.url;if(m===undefined){m=s.config["filebrowser"+b(o)+"BrowseUrl"];if(m===undefined){m=s.config.filebrowserBrowseUrl}}if(m){q.onClick=g;q.filebrowser.url=m;q.hidden=false}}else{if(q.filebrowser.action=="QuickUpload"&&q["for"]){m=q.filebrowser.url;if(m===undefined){m=s.config["filebrowser"+b(o)+"UploadUrl"];if(m===undefined){m=s.config.filebrowserUploadUrl}}if(m){var t=q.onClick;q.onClick=function(u){var v=u.sender;if(t&&t.call(v,u)===false){return false}if(k.call(v,u)){var w=v.getDialog().getContentElement(this["for"][0],this["for"][1]).getInputElement();f(w);return true}return false};q.filebrowser.url=m;q.hidden=false;i(s,n.getContents(q["for"][0]).get(q["for"][1]),q.filebrowser)}}}}}function j(n,m){var p=m.getDialog();var l=m.filebrowser.target||null;if(l){var q=l.split(":");var o=p.getContentElement(q[0],q[1]);if(o){o.setValue(n);p.selectPage(q[0])}}}function a(o,m,l){if(l.indexOf(";")!==-1){var p=l.split(";");for(var n=0;n<p.length;n++){if(a(o,m,p[n])){return true}}return false}var q=o.getContents(m).get(l).filebrowser;return(q&&q.url)}function e(m,p){var o=this._.filebrowserSe.getDialog(),l=this._.filebrowserSe["for"],n=this._.filebrowserSe.filebrowser.onSelect;if(l){o.getContentElement(l[0],l[1]).reset()}if(typeof p=="function"&&p.call(this._.filebrowserSe)===false){return}if(n&&n.call(this._.filebrowserSe,m,p)===false){return}if(typeof p=="string"&&p){alert(p)}if(m){j(m,this._.filebrowserSe)}}CKEDITOR.plugins.add("filebrowser",{requires:"popup",init:function(l){l._.filebrowserFn=CKEDITOR.tools.addFunction(e,l);l.on("destroy",function(){CKEDITOR.tools.removeFunction(this._.filebrowserFn)})}});CKEDITOR.on("dialogDefinition",function(l){if(!l.editor.plugins.filebrowser){return}var o=l.data.definition,n;for(var m=0;m<o.contents.length;++m){if((n=o.contents[m])){d(l.editor,l.data.name,o,n.elements);if(n.hidden&&n.filebrowser){n.hidden=!a(o,n.id,n.filebrowser)}}}})})();